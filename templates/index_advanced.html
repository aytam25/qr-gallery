<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ settings.site_title }} | معرض فني</title>

    <!-- SEO -->
    <meta name="description" content="{{ settings.site_description or 'معرض أعمال فني احترافي' }}">

    <!-- Fonts & Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Bootstrap & Lightbox -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.4/css/lightbox.min.css">

    <!-- Swiper CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />

    <style>
        /* ===== المتغيرات الأساسية ===== */
        :root {
            --primary: {{ settings.theme_color or '#667eea' }};
            --primary-dark: #5a67d8;
            --secondary: #764ba2;
            --gradient: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            --dark: #0f172a;
            --light: #f8fafc;
            --gray: #64748b;
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 20px 40px rgba(0, 0, 0, 0.2);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --radius: 16px;
            --radius-lg: 24px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Cairo', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
            color: var(--dark);
            overflow-x: hidden;
            line-height: 1.6;
        }

        /* ===== شريط التنقل الزجاجي ===== */
        .navbar {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(12px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
            padding: 12px 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .navbar .container {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
            color: var(--dark);
            font-weight: 700;
            font-size: 1.5rem;
            transition: var(--transition);
        }

        .logo:hover {
            color: var(--primary);
        }

        .logo img {
            max-height: 50px;
            border-radius: 10px;
            transition: transform 0.3s;
        }

        .logo img:hover {
            transform: scale(1.05);
        }

        .nav-menu {
            display: flex;
            gap: 25px;
        }

        .nav-menu a {
            text-decoration: none;
            color: var(--dark);
            font-weight: 600;
            position: relative;
            padding: 5px 0;
            transition: var(--transition);
        }

        .nav-menu a::after {
            content: '';
            position: absolute;
            bottom: 0;
            right: 0;
            width: 0;
            height: 2px;
            background: var(--gradient);
            transition: width 0.3s;
        }

        .nav-menu a:hover::after,
        .nav-menu a.active::after {
            width: 100%;
        }

        .nav-menu a:hover {
            color: var(--primary);
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .search-form {
            position: relative;
        }

        .search-form input {
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 50px;
            padding: 8px 40px 8px 20px;
            width: 200px;
            transition: var(--transition);
            background: rgba(255, 255, 255, 0.8);
        }

        .search-form input:focus {
            width: 250px;
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            background: white;
        }

        .search-form button {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--gray);
        }

        .header-icon {
            background: var(--gradient);
            color: white;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            text-decoration: none;
            transition: var(--transition);
            box-shadow: var(--shadow);
        }

        .header-icon:hover {
            transform: scale(1.1);
            color: white;
        }

        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--dark);
        }

        /* ===== لوحة الترحيب المتحركة ===== */
        .hero {
            position: relative;
            height: 500px;
            overflow: hidden;
            margin-bottom: 40px;
        }

        .hero-slides {
            position: relative;
            height: 100%;
        }

        .hero-slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.8s ease, visibility 0.8s ease;
        }

        .hero-slide.active {
            opacity: 1;
            visibility: visible;
        }

        .hero-slide img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .hero-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to right, rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.2));
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            color: white;
            padding: 20px;
        }

        .hero-content {
            max-width: 800px;
            animation: fadeInUp 1s ease;
        }

        .hero-content h1 {
            font-size: 4rem;
            font-weight: 800;
            margin-bottom: 20px;
            text-shadow: 2px 2px 10px rgba(0, 0, 0, 0.5);
        }

        .hero-content p {
            font-size: 1.3rem;
            margin-bottom: 30px;
            opacity: 0.9;
        }

        .hero-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .hero-buttons .btn {
            padding: 12px 40px;
            border-radius: 50px;
            font-weight: 600;
            transition: var(--transition);
            border: none;
        }

        .hero-buttons .btn-primary {
            background: var(--gradient);
            color: white;
        }

        .hero-buttons .btn-outline-light {
            background: transparent;
            border: 2px solid white;
            color: white;
        }

        .hero-buttons .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }

        .hero-nav {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            z-index: 10;
        }

        .hero-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            cursor: pointer;
            transition: var(--transition);
        }

        .hero-dot.active {
            background: white;
            transform: scale(1.3);
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }

        .hero-arrows {
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            transform: translateY(-50%);
            display: flex;
            justify-content: space-between;
            padding: 0 30px;
            z-index: 10;
        }

        .hero-arrow {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            transition: var(--transition);
            backdrop-filter: blur(4px);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .hero-arrow:hover {
            background: var(--gradient);
            border-color: transparent;
            transform: scale(1.1);
        }

        /* ===== عناوين الأقسام ===== */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0;
            position: relative;
            display: inline-block;
        }

        .section-title i {
            color: var(--primary);
            margin-left: 10px;
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: -10px;
            right: 0;
            width: 60px;
            height: 3px;
            background: var(--gradient);
            border-radius: 3px;
        }

        .view-all {
            background: transparent;
            border: 1px solid var(--primary);
            color: var(--primary);
            padding: 8px 20px;
            border-radius: 50px;
            text-decoration: none;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .view-all:hover {
            background: var(--gradient);
            color: white;
            border-color: transparent;
            transform: translateY(-2px);
        }

        /* ===== سلايدر التصنيفات ===== */
        .categories-section {
            padding: 60px 0;
            background: white;
        }

        .categories-swiper {
            padding: 20px 5px;
        }

        .category-card {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-radius: var(--radius);
            padding: 25px 15px;
            text-align: center;
            transition: var(--transition);
            border: 1px solid rgba(0, 0, 0, 0.05);
            box-shadow: var(--shadow);
            height: 100%;
        }

        .category-card:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary);
        }

        .category-image {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            margin: 0 auto 20px;
            overflow: hidden;
            border: 3px solid var(--primary);
            padding: 5px;
            background: white;
        }

        .category-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }

        .category-icon {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            margin: 0 auto 20px;
            background: var(--gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            color: white;
        }

        .category-card h4 {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .category-card p {
            color: var(--gray);
            font-size: 0.9rem;
            margin-bottom: 0;
        }

        /* ===== الصور المميزة (Featured) ===== */
        .featured-section {
            padding: 60px 0;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
        }

        .featured-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
        }

        .featured-card {
            background: white;
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .featured-card:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary);
        }

        .featured-image {
            position: relative;
            height: 200px;
            overflow: hidden;
        }

        .featured-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s;
        }

        .featured-card:hover .featured-image img {
            transform: scale(1.1);
        }

        .featured-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: linear-gradient(135deg, gold, #ffc107);
            color: #333;
            padding: 5px 12px;
            border-radius: 50px;
            font-size: 0.8rem;
            font-weight: bold;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            z-index: 2;
        }

        .featured-info {
            padding: 20px;
        }

        .featured-info h3 {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .featured-info p {
            color: var(--gray);
            font-size: 0.9rem;
            margin-bottom: 15px;
        }

        .featured-stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            font-size: 0.9rem;
        }

        .featured-stats i {
            color: var(--primary);
            margin-left: 5px;
        }

        .featured-btn {
            background: var(--gradient);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            text-decoration: none;
            display: inline-block;
            width: 100%;
            text-align: center;
            transition: var(--transition);
            font-weight: 600;
        }

        .featured-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
            color: white;
        }

        /* ===== الصور الحديثة (Recent) ===== */
        .recent-section {
            padding: 60px 0;
            background: white;
        }

        .recent-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 20px;
        }

        .recent-card {
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .recent-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary);
        }

        .recent-image {
            position: relative;
            height: 150px;
            overflow: hidden;
        }

        .recent-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s;
        }

        .recent-card:hover .recent-image img {
            transform: scale(1.1);
        }

        .recent-info {
            padding: 15px;
            text-align: center;
        }

        .recent-info h4 {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .recent-info .views {
            font-size: 0.85rem;
            color: var(--gray);
        }

        .recent-info .views i {
            color: var(--primary);
            margin-left: 3px;
        }

        /* ===== جميع الصور (All Images) ===== */
        .gallery-section {
            padding: 60px 0;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
        }

        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
        }

        .gallery-item {
            position: relative;
            border-radius: var(--radius);
            overflow: hidden;
            cursor: pointer;
            aspect-ratio: 1/1;
            box-shadow: var(--shadow);
        }

        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s;
        }

        .gallery-item:hover img {
            transform: scale(1.1);
        }

        .gallery-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(0, 0, 0, 0.8), transparent);
            color: white;
            padding: 20px;
            transform: translateY(100%);
            transition: transform 0.3s;
        }

        .gallery-item:hover .gallery-overlay {
            transform: translateY(0);
        }

        .gallery-stats {
            display: flex;
            gap: 15px;
            font-size: 0.9rem;
        }

        .gallery-stats i {
            margin-left: 5px;
        }

        /* ===== Lightbox ===== */
        #lightbox {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 9999;
            justify-content: center;
            align-items: center;
        }

        #lightbox span {
            position: absolute;
            top: 20px;
            right: 30px;
            color: white;
            font-size: 40px;
            cursor: pointer;
            transition: transform 0.3s;
        }

        #lightbox span:hover {
            transform: scale(1.2);
        }

        #lightbox img {
            max-width: 90%;
            max-height: 80%;
            object-fit: contain;
        }

        /* ===== تحسينات الموبايل ===== */
        @media (max-width: 992px) {
            .nav-menu {
                display: none;
            }

            .mobile-menu-btn {
                display: block;
            }

            .search-form input {
                width: 150px;
            }

            .search-form input:focus {
                width: 180px;
            }

            .hero-content h1 {
                font-size: 3rem;
            }
        }

        @media (max-width: 768px) {
            .hero {
                height: 400px;
            }

            .hero-content h1 {
                font-size: 2.2rem;
            }

            .hero-content p {
                font-size: 1rem;
            }

            .hero-buttons {
                flex-direction: column;
                gap: 10px;
            }

            .hero-arrows {
                display: none;
            }

            .section-title {
                font-size: 1.5rem;
            }

            .featured-grid,
            .gallery-grid {
                grid-template-columns: 1fr;
            }

            .recent-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 480px) {
            .hero {
                height: 300px;
            }

            .hero-content h1 {
                font-size: 1.8rem;
            }

            .hero-buttons .btn {
                padding: 8px 20px;
            }

            .recent-grid {
                grid-template-columns: 1fr;
            }

            .header-actions {
                gap: 10px;
            }

            .search-form input {
                width: 120px;
            }

            .search-form input:focus {
                width: 140px;
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body>

    <!-- ===== شريط التنقل الزجاجي ===== -->
    <nav class="navbar">
        <div class="container">
            <a href="{{ url_for('index') }}" class="logo">
                {% if settings and settings.site_logo %}
                    <img src="{{ settings.site_logo }}" alt="{{ settings.site_title }}">
                {% else %}
                    <i class="fas fa-camera-retro"></i>
                    <span>{{ settings.site_title }}</span>
                {% endif %}
            </a>

            <div class="nav-menu">
                <a href="{{ url_for('index') }}" class="active">الرئيسية</a>
                <a href="#featured">مميزة</a>
                <a href="#recent">حديثة</a>
                <a href="#gallery">جميع الصور</a>
                <a href="{{ url_for('about') }}">من نحن</a>
                <a href="{{ url_for('contact') }}">اتصل بنا</a>
            </div>

            <div class="header-actions">
                <form class="search-form" action="{{ url_for('search') }}" method="GET">
                    <input type="text" name="q" placeholder="بحث عن صور...">
                    <button type="submit"><i class="fas fa-search"></i></button>
                </form>

                {% if current_user.is_authenticated %}
                <a href="{{ url_for('profile') }}" class="header-icon"><i class="fas fa-user"></i></a>
                {% else %}
                <a href="{{ url_for('login') }}" class="header-icon"><i class="fas fa-sign-in-alt"></i></a>
                {% endif %}

                <button class="mobile-menu-btn" id="mobileMenuBtn">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- ===== لوحة الترحيب المتحركة ===== -->
    <section class="hero">
        <div class="hero-slides">
            {% if featured_images %}
                {% for image in featured_images[:3] %}
                <div class="hero-slide {% if loop.first %}active{% endif %}">
                    <img src="{{ image.image_url }}" alt="{{ image.title }}">
                </div>
                {% endfor %}
            {% else %}
                <div class="hero-slide active">
                    <img src="https://via.placeholder.com/1920x800?text=مرحباً+بكم+في+المعرض">
                </div>
                <div class="hero-slide">
                    <img src="https://via.placeholder.com/1920x800?text=أعمال+فنية+رائعة">
                </div>
                <div class="hero-slide">
                    <img src="https://via.placeholder.com/1920x800?text=إبداع+لا+محدود">
                </div>
            {% endif %}
        </div>

        <div class="hero-overlay">
            <div class="hero-content">
                <h1>{{ settings.site_title }}</h1>
                <p>{{ settings.site_description or 'معرض فني يضم أجمل الأعمال والإبداعات' }}</p>
                <div class="hero-buttons">
                    <a href="#gallery" class="btn btn-primary">استعرض الصور</a>
                    <a href="#featured" class="btn btn-outline-light">صور مميزة</a>
                </div>
            </div>
        </div>

        <div class="hero-nav">
            {% if featured_images %}
                {% for image in featured_images[:3] %}
                <div class="hero-dot {% if loop.first %}active{% endif %}" data-slide="{{ loop.index0 }}"></div>
                {% endfor %}
            {% else %}
                <div class="hero-dot active" data-slide="0"></div>
                <div class="hero-dot" data-slide="1"></div>
                <div class="hero-dot" data-slide="2"></div>
            {% endif %}
        </div>

        <div class="hero-arrows">
            <div class="hero-arrow hero-prev"><i class="fas fa-chevron-right"></i></div>
            <div class="hero-arrow hero-next"><i class="fas fa-chevron-left"></i></div>
        </div>
    </section>

    <!-- ===== أقسام التصنيفات ===== -->
    {% if categories %}
    <section class="categories-section">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title"><i class="fas fa-th-large"></i> تصفح الأقسام</h2>
                <a href="#" class="view-all">عرض الكل <i class="fas fa-arrow-left"></i></a>
            </div>

            <div class="swiper categories-swiper">
                <div class="swiper-wrapper">
                    {% for category, count in categories %}
                    <div class="swiper-slide">
                        <a href="{{ url_for('index') }}?category={{ category.id }}" class="text-decoration-none">
                            <div class="category-card">
                                <div class="category-image">
                                    <img src="https://via.placeholder.com/100x100?text={{ category.name[0] }}" alt="{{ category.name }}">
                                </div>
                                <h4>{{ category.name }}</h4>
                                <p>{{ count }} صورة</p>
                            </div>
                        </a>
                    </div>
                    {% endfor %}
                </div>
                <div class="swiper-pagination"></div>
                <div class="swiper-button-prev"></div>
                <div class="swiper-button-next"></div>
            </div>
        </div>
    </section>
    {% endif %}

    <!-- ===== الصور المميزة ===== -->
    {% if featured_images %}
    <section id="featured" class="featured-section">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title"><i class="fas fa-star"></i> صور مميزة</h2>
                <a href="#" class="view-all">عرض الكل <i class="fas fa-arrow-left"></i></a>
            </div>

            <div class="featured-grid">
                {% for image in featured_images[:8] %}
                <div class="featured-card">
                    <div class="featured-image">
                        <img src="{{ image.image_url }}" alt="{{ image.title }}">
                        <span class="featured-badge"><i class="fas fa-star"></i> مميزة</span>
                    </div>
                    <div class="featured-info">
                        <h3>{{ image.title }}</h3>
                        <p>{{ image.description|truncate(50) }}</p>
                        <div class="featured-stats">
                            <span><i class="fas fa-eye"></i> {{ image.views }}</span>
                            <span><i class="fas fa-download"></i> {{ image.downloads }}</span>
                        </div>
                        <a href="{{ url_for('view_image', image_id=image.id) }}" class="featured-btn">
                            <i class="fas fa-info-circle"></i> عرض التفاصيل
                        </a>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </section>
    {% endif %}

    <!-- ===== الصور الحديثة ===== -->
    {% if images and images.items %}
    <section id="recent" class="recent-section">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title"><i class="fas fa-clock"></i> أحدث الصور</h2>
                <a href="#" class="view-all">عرض الكل <i class="fas fa-arrow-left"></i></a>
            </div>

            <div class="recent-grid">
                {% for image in images.items[:8] %}
                <div class="recent-card" onclick="openLightbox('{{ image.image_url }}', {{ image.id }})">
                    <div class="recent-image">
                        <img src="{{ image.thumbnail_url or image.image_url }}" alt="{{ image.title }}">
                    </div>
                    <div class="recent-info">
                        <h4>{{ image.title|truncate(20) }}</h4>
                        <div class="views"><i class="fas fa-eye"></i> {{ image.views }}</div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </section>
    {% endif %}

    <!-- ===== جميع الصور ===== -->
    <section id="gallery" class="gallery-section">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title"><i class="fas fa-images"></i> جميع الصور</h2>
            </div>

            {% if images and images.items %}
            <div class="gallery-grid">
                {% for image in images.items %}
                <div class="gallery-item" onclick="openLightbox('{{ image.image_url }}', {{ image.id }})">
                    <img src="{{ image.thumbnail_url or image.image_url }}" alt="{{ image.title }}">
                    <div class="gallery-overlay">
                        <div class="gallery-stats">
                            <span><i class="fas fa-eye"></i> <span class="view-count-{{ image.id }}">{{ image.views }}</span></span>
                            <span><i class="fas fa-download"></i> {{ image.downloads }}</span>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>

            <!-- التصفح بين الصفحات -->
            {% if images.pages > 1 %}
            <nav class="mt-5">
                <ul class="pagination justify-content-center">
                    {% if images.has_prev %}
                    <li class="page-item">
                        <a class="page-link" href="{{ url_for('index', page=images.prev_num, category=current_category, q=search_query) }}">
                            <i class="fas fa-chevron-right"></i> السابق
                        </a>
                    </li>
                    {% endif %}

                    {% for page_num in images.iter_pages() %}
                        {% if page_num %}
                        <li class="page-item {% if page_num == images.page %}active{% endif %}">
                            <a class="page-link" href="{{ url_for('index', page=page_num, category=current_category, q=search_query) }}">{{ page_num }}</a>
                        </li>
                        {% else %}
                        <li class="page-item disabled"><span class="page-link">...</span></li>
                        {% endif %}
                    {% endfor %}

                    {% if images.has_next %}
                    <li class="page-item">
                        <a class="page-link" href="{{ url_for('index', page=images.next_num, category=current_category, q=search_query) }}">
                            التالي <i class="fas fa-chevron-left"></i>
                        </a>
                    </li>
                    {% endif %}
                </ul>
            </nav>
            {% endif %}

            {% else %}
            <div class="text-center py-5">
                <i class="fas fa-images fa-4x" style="color: var(--gray);"></i>
                <h3 class="mt-3">لا توجد صور بعد</h3>
                <p>ابدأ بإضافة صور رائعة إلى المعرض</p>
                {% if current_user.is_authenticated %}
                <a href="{{ url_for('upload_images') }}" class="btn btn-primary mt-3">أضف أول صورة</a>
                {% endif %}
            </div>
            {% endif %}
        </div>
    </section>

    <!-- ===== Lightbox ===== -->
    <div id="lightbox">
        <span onclick="closeLightbox()">&times;</span>
        <img id="lightbox-img" src="" alt="">
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

    <script>
        // ===== لوحة الترحيب المتحركة =====
        let currentHeroSlide = 0;
        const heroSlides = document.querySelectorAll('.hero-slide');
        const heroDots = document.querySelectorAll('.hero-dot');
        const heroPrev = document.querySelector('.hero-prev');
        const heroNext = document.querySelector('.hero-next');
        let heroInterval;

        function showHeroSlide(index) {
            if (!heroSlides.length) return;
            if (index >= heroSlides.length) index = 0;
            if (index < 0) index = heroSlides.length - 1;
            heroSlides.forEach(s => s.classList.remove('active'));
            heroDots.forEach(d => d.classList.remove('active'));
            heroSlides[index].classList.add('active');
            heroDots[index].classList.add('active');
            currentHeroSlide = index;
        }

        function nextHeroSlide() {
            showHeroSlide(currentHeroSlide + 1);
        }

        function prevHeroSlide() {
            showHeroSlide(currentHeroSlide - 1);
        }

        function startHeroAutoSlide() {
            if (heroSlides.length > 1) {
                heroInterval = setInterval(nextHeroSlide, 5000);
            }
        }

        if (heroPrev && heroNext) {
            heroPrev.addEventListener('click', () => {
                prevHeroSlide();
                clearInterval(heroInterval);
                startHeroAutoSlide();
            });
            heroNext.addEventListener('click', () => {
                nextHeroSlide();
                clearInterval(heroInterval);
                startHeroAutoSlide();
            });
            heroDots.forEach((dot, i) => {
                dot.addEventListener('click', () => {
                    showHeroSlide(i);
                    clearInterval(heroInterval);
                    startHeroAutoSlide();
                });
            });
        }

        if (heroSlides.length > 0) {
            startHeroAutoSlide();
        }

        // ===== سلايدر التصنيفات =====
        new Swiper('.categories-swiper', {
            slidesPerView: 2,
            spaceBetween: 15,
            loop: true,
            autoplay: {
                delay: 3000,
                disableOnInteraction: false,
            },
            pagination: {
                el: '.swiper-pagination',
                clickable: true,
            },
            navigation: {
                nextEl: '.swiper-button-next',
                prevEl: '.swiper-button-prev',
            },
            breakpoints: {
                480: { slidesPerView: 3, spaceBetween: 20 },
                640: { slidesPerView: 4, spaceBetween: 20 },
                768: { slidesPerView: 5, spaceBetween: 25 },
                1024: { slidesPerView: 6, spaceBetween: 25 },
            },
        });

        // ===== Lightbox =====
        function openLightbox(src, id) {
            document.getElementById('lightbox').style.display = 'flex';
            document.getElementById('lightbox-img').src = src;
            fetch(`/api/view/${id}`, { method: 'POST' })
                .then(r => r.json())
                .then(d => {
                    if (d.success) {
                        let el = document.querySelector(`.view-count-${id}`);
                        if (el) el.textContent = d.views;
                    }
                })
                .catch(e => console.log(e));
        }

        function closeLightbox() {
            document.getElementById('lightbox').style.display = 'none';
        }

        document.addEventListener('keydown', e => {
            if (e.key === 'Escape') closeLightbox();
        });

        // ===== قائمة الموبايل =====
        document.getElementById('mobileMenuBtn')?.addEventListener('click', () => {
            alert('سيتم إضافة قائمة الموبايل هنا');
        });
    </script>
</body>
</html>