<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ settings.site_title }}</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />

    <style>
        :root {
            --primary-color: {{ settings.theme_color or '#4f46e5' }};
            --dark-blue: #0f172a;
            --glass: rgba(255, 255, 255, 0.95);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f1f5f9;
        }

        /* ===== شريط التنقل (Navbar) المطور ===== */
        .navbar {
            background: var(--glass) !important;
            backdrop-filter: blur(10px);
            border-bottom: 2px solid var(--primary-color);
            padding: 10px 0;
            z-index: 1050;
        }

        .navbar-brand img {
            max-height: 45px;
            border-radius: 5px;
        }

        .user-badge {
            background: var(--primary-color);
            color: white !important;
            padding: 5px 15px;
            border-radius: 50px;
            font-weight: 600;
        }

        /* ===== قسم الترحيب (Hero) مع مكان الشعار المحدد ===== */
        .hero-banner {
            background: var(--dark-blue);
            padding: 80px 0;
            color: white;
            text-align: center;
            position: relative;
            margin-top: 60px;
        }

        /* الشعار في منطقة الدائرة (كما طلبت في الصورة) */
        .hero-logo-area {
            position: absolute;
            top: 50%;
            left: 10%; /* جهة الدائرة الحمراء في الصورة */
            transform: translateY(-50%);
            width: 150px;
            height: 150px;
            border: 2px dashed rgba(255,255,255,0.3);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            background: rgba(255,255,255,0.05);
        }

        .hero-logo-area img {
            width: 80%;
            height: 80%;
            object-fit: contain;
        }

        .hero-title { font-size: 3rem; font-weight: 800; margin-bottom: 10px; }
        .hero-subtitle { font-size: 1.5rem; opacity: 0.8; }

        /* ===== قسم التصنيفات (Pills) ===== */
        .category-section {
            padding: 30px 0;
            background: white;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }

        .category-pill {
            display: inline-block;
            padding: 8px 25px;
            margin: 5px;
            border-radius: 50px;
            background: #f8fafc;
            color: var(--dark-blue);
            text-decoration: none;
            font-weight: 600;
            border: 1px solid #e2e8f0;
            transition: 0.3s;
        }

        .category-pill:hover, .category-pill.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        /* ===== معرض الصور ===== */
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
            padding: 40px 0;
        }

        .gallery-card {
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 20px rgba(0,0,0,0.05);
            transition: 0.3s;
        }

        .gallery-card:hover { transform: translateY(-10px); }

        .img-wrapper { height: 250px; background: #eee; overflow: hidden; }
        .img-wrapper img { width: 100%; height: 100%; object-fit: cover; }

        /* موبايل */
        @media (max-width: 768px) {
            .hero-logo-area { position: static; margin: 20px auto; transform: none; }
            .hero-title { font-size: 2rem; }
        }
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg fixed-top shadow-sm">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center" href="{{ url_for('index') }}">
                {% if settings and settings.site_logo %}
                    <img src="{{ settings.site_logo }}" alt="شعار">
                {% else %}
                    <span class="fw-bold" style="color: var(--primary-color);">{{ settings.site_title }}</span>
                {% endif %}
            </a>

            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav mx-auto">
                    <li class="nav-item"><a class="nav-link fw-bold" href="{{ url_for('index') }}">الرئيسية</a></li>
                    <li class="nav-item"><a class="nav-link fw-bold" href="#gallery">المعرض</a></li>
                    {% if categories %}
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle fw-bold" href="#" data-bs-toggle="dropdown">الأقسام</a>
                        <ul class="dropdown-menu">
                            {% for category, count in categories %}
                            <li><a class="dropdown-item" href="{{ url_for('index', category=category.id) }}">{{ category.name }}</a></li>
                            {% endfor %}
                        </ul>
                    </li>
                    {% endif %}
                </ul>

                <div class="d-flex align-items-center gap-3">
                    <button class="btn btn-outline-dark btn-sm rounded-circle" data-bs-toggle="modal" data-bs-target="#qrModal">
                        <i class="bi bi-qr-code"></i>
                    </button>

                    {% if current_user.is_authenticated %}
                    <div class="dropdown">
                        <a href="#" class="user-badge text-decoration-none dropdown-toggle" data-bs-toggle="dropdown">
                            <i class="bi bi-person-fill"></i> {{ current_user.username }}
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end shadow border-0">
                            <li><a class="dropdown-item" href="{{ url_for('profile') }}">إعدادات الحساب</a></li>
                            {% if current_user.role in ['admin', 'editor'] %}
                            <li><a class="dropdown-item fw-bold text-primary" href="{{ url_for('admin_dashboard') }}">لوحة التحكم</a></li>
                            {% endif %}
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item text-danger" href="{{ url_for('logout') }}">تسجيل خروج</a></li>
                        </ul>
                    </div>
                    {% else %}
                    <a class="btn btn-sm btn-outline-primary px-3 rounded-pill" href="{{ url_for('login') }}">دخول</a>
                    {% endif %}
                </div>
            </div>
        </div>
    </nav>

    <header class="hero-banner">
        <div class="container position-relative">
            <h1 class="hero-title animate__animated animate__fadeInDown">{{ settings.site_title }}</h1>
            <p class="hero-subtitle animate__animated animate__fadeInUp">{{ settings.site_description }}</p>
            
            <div class="hero-logo-area animate__animated animate__zoomIn">
                {% if settings and settings.site_logo %}
                    <img src="{{ settings.site_logo }}" alt="شعار المؤسسة">
                {% else %}
                    <i class="bi bi-patch-check-fill fs-1 text-white-50"></i>
                {% endif %}
            </div>
        </div>
    </header>

    <section class="category-section text-center">
        <div class="container">
            <h6 class="mb-3 text-muted fw-bold">تصفح حسب القسم:</h6>
            <div class="category-pills">
                <a href="{{ url_for('index') }}" class="category-pill {% if not current_category %}active{% endif %}">الكل</a>
                {% for category, count in categories %}
                <a href="{{ url_for('index', category=category.id) }}" class="category-pill {% if current_category == category.id|string %}active{% endif %}">
                    {{ category.name }} <span class="badge bg-white text-dark ms-1">{{ count }}</span>
                </a>
                {% endfor %}
            </div>
        </div>
    </section>


    <!-- ===== قسم الترحيب ===== -->
    <section class="hero-section">
        <div class="container hero-content">
            {% if settings and settings.site_logo %}
                <img src="{{ settings.site_logo }}" alt="شعار" style="max-height:100px; margin-bottom:1.5rem; border-radius:20px; box-shadow:var(--shadow);">
            {% endif %}
            <h1 class="hero-title">{{ settings.site_title }}</h1>
            <p class="hero-description">{{ settings.site_description }}</p>
            <div class="hero-buttons">
                <a href="#gallery" class="btn btn-light"><i class="bi bi-images me-2"></i>استعرض الأعمال</a>
                <a href="#featured" class="btn btn-outline-light"><i class="bi bi-star-fill me-2"></i>المميزة</a>
            </div>
        </div>
    </section>



<!-- ===== كاروسيل Swiper الاحترافي مع صور مضبوطة ===== -->
<section class="swiper-flip-section" style="margin-top: 70px; height: 500px; width: 100%;">
    <div class="swiper myFlipSwiper" style="height: 100%; width: 100%;">
        <div class="swiper-wrapper">
            {% for image in featured_images[:6] %}
            <div class="swiper-slide">
                <div class="flip-slide-content">
                    <img src="{{ image.image_url }}" 
                         alt="{{ image.title }}"
                         style="width:100%; height:100%; object-fit:cover;"
                         onerror="this.src='https://via.placeholder.com/1200x600?text=صورة'">
                    <div class="overlay"></div>
                    <div class="flip-slide-text">
                        <h3>{{ image.title or 'عمل إبداعي' }}</h3>
                        <p>{{ image.description|truncate(100) or 'تصميم احترافي بجودة عالية' }}</p>
                        <a href="{{ url_for('view_image', image_id=image.id) }}" class="btn btn-light">
                            <i class="bi bi-eye me-2"></i>عرض التفاصيل
                        </a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        <div class="swiper-button-next"></div>
        <div class="swiper-button-prev"></div>
        <div class="swiper-pagination"></div>
    </div>
</section>

    
    <!-- ===== البحث ===== -->
    <section class="search-section">
        <div class="container">
            <div class="search-box">
                <form action="{{ url_for('search') }}" method="GET">
                    <div class="input-group">
                        <input type="text" class="form-control" name="q" placeholder="ابحث عن صور..." value="{{ search_query }}">
                        <button class="btn" type="submit"><i class="bi bi-search me-2"></i>بحث</button>
                    </div>
                </form>
            </div>
        </div>
    </section>

    <!-- ===== التصنيفات ===== -->
    {% if categories %}
    <section class="categories-section">
        <div class="container">
            <div class="category-pills">
                <a href="{{ url_for('index') }}" class="category-pill {% if not current_category %}active{% endif %}">الكل</a>
                {% for category, count in categories %}
                <a href="{{ url_for('index') }}?category={{ category.id }}" class="category-pill {% if current_category == category.id %}active{% endif %}">
                    {{ category.name }} ({{ count }})
                </a>
                {% endfor %}
            </div>
        </div>
    </section>
    {% endif %}

 


<!-- ===== الصور المميزة بمعادلات ذكية ===== -->
<section id="featured" class="featured-section">
    <div class="container">
        <h2 class="section-title"><i class="bi bi-star-fill me-2"></i>صور مميزة</h2>
        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px;">
            {% for image in featured_images %}
            <div style="border-radius: 15px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.2); transition: transform 0.3s;">
                <div style="position: relative; width: 100%; padding-top: 75%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                    <!-- padding-top: 75% = نسبة ارتفاع 3:4 (مثالية للصور العمودية والأفقية) -->
                    <img src="{{ image.thumbnail_url or image.image_url }}" 
                         alt="{{ image.title }}"
                         style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: contain; background: #1a1a1a; padding: 5px;"
                         onerror="this.src='https://via.placeholder.com/300x225?text=صورة'"
                         loading="lazy">
                    
                    <!-- شارة مميزة -->
                    <span style="position: absolute; top: 10px; right: 10px; background: gold; color: #333; padding: 5px 10px; border-radius: 20px; font-size: 12px; font-weight: bold; z-index: 10;">
                        <i class="bi bi-star-fill"></i>
                    </span>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>


 

    
    <main class="container py-5" id="gallery">
        <div class="gallery-grid">
            {% for image in images.items %}
            <div class="gallery-card animate__animated animate__fadeInUp">
                <div class="img-wrapper" onclick="openLightbox('{{ image.image_url }}', '{{ image.title }}', '{{ image.description }}')">
                    <img src="{{ image.thumbnail_url or image.image_url }}" alt="{{ image.title }}" loading="lazy">
                </div>
                <div class="p-4">
                    <span class="badge bg-primary mb-2">{{ image.category.name if image.category else 'عام' }}</span>
                    <h5 class="fw-bold">{{ image.title }}</h5>
                    <div class="d-flex justify-content-between text-muted small mt-3">
                        <span><i class="bi bi-eye"></i> {{ image.views }}</span>
                        <span><i class="bi bi-calendar-event"></i> إنجازاتنا</span>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </main>

    <div class="modal fade" id="qrModal" tabindex="-1">
        <div class="modal-dialog modal-sm modal-dialog-centered">
            <div class="modal-content text-center p-4 rounded-4">
                <h5 class="mb-3">مسح الكود للمشاركة</h5>
                <img src="data:image/png;base64,{{ qr_code }}" class="img-fluid rounded shadow-sm mb-3">
                <button class="btn btn-primary w-100 rounded-pill" onclick="copyLink()">نسخ رابط الموقع</button>
                <div id="copyMsg" class="text-success small mt-2" style="display:none;">تم النسخ!</div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function copyLink() {
            navigator.clipboard.writeText(window.location.href);
            document.getElementById('copyMsg').style.display = 'block';
            setTimeout(() => { document.getElementById('copyMsg').style.display = 'none'; }, 2000);
        }

        // هنا تضع سكريبت الـ Lightbox الخاص بك كما في ملفك الأصلي
    </script>
</body>
</html>
